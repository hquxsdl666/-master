# 中医脉象诊断系统 - 数据库设计文档

## 一、数据库架构

```
┌─────────────────────────────────────────────────────────────────┐
│                      数据库架构设计                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   用户数据    │  │   脉诊数据    │  │   中医知识    │          │
│  │    库       │  │    库       │  │    库       │          │
│  │  (SQLite)   │  │  (SQLite)   │  │  (PostgreSQL)│          │
│  │             │  │             │  │             │          │
│  │ • 用户表    │  │ • 脉诊记录   │  │ • 方剂表    │          │
│  │ • 设备表    │  │ • 脉象特征   │  │ • 药材表    │          │
│  │ • 配置表    │  │ • 分析报告   │  │ • 证型表    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐                            │
│  │   缓存数据    │  │   日志数据    │                            │
│  │   (Redis)   │  │  (MongoDB)   │                            │
│  │             │  │             │                            │
│  │ • 会话缓存  │  │ • 操作日志  │                            │
│  │ • 热点数据  │  │ • 错误日志  │                            │
│  │ • 临时数据  │  │ • 性能日志  │                            │
│  └──────────────┘  └──────────────┘                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 二、核心数据表设计

### 2.1 用户相关表

#### 2.1.1 用户表 (users)

```sql
CREATE TABLE users (
    id VARCHAR(36) PRIMARY KEY,           -- UUID
    phone VARCHAR(20) UNIQUE,              -- 手机号
    email VARCHAR(100) UNIQUE,             -- 邮箱
    password_hash VARCHAR(255),            -- 密码哈希
    nickname VARCHAR(50),                  -- 昵称
    avatar_url VARCHAR(255),               -- 头像URL
    real_name VARCHAR(50),                 -- 真实姓名
    id_card VARCHAR(18),                   -- 身份证号(加密)
    gender TINYINT DEFAULT 0,              -- 性别: 0未知 1男 2女
    birth_date DATE,                       -- 出生日期
    age TINYINT,                           -- 年龄(计算字段)
    height DECIMAL(5,2),                   -- 身高(cm)
    weight DECIMAL(5,2),                   -- 体重(kg)
    body_type VARCHAR(20),                 -- 体型: slim/normal/overweight
    constitution VARCHAR(50),              -- 体质类型
    medical_history TEXT,                  -- 病史(JSON)
    allergies TEXT,                        -- 过敏史
    status TINYINT DEFAULT 1,              -- 状态: 0禁用 1正常
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_login_at TIMESTAMP,               -- 最后登录时间
    
    INDEX idx_phone (phone),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.1.2 用户设备表 (user_devices)

```sql
CREATE TABLE user_devices (
    id VARCHAR(36) PRIMARY KEY,
    user_id VARCHAR(36) NOT NULL,
    device_id VARCHAR(50) NOT NULL,        -- 设备唯一标识
    device_type VARCHAR(30),               -- 设备类型: watch_gt4/watch_gt5等
    device_name VARCHAR(100),              -- 设备名称
    device_model VARCHAR(50),              -- 设备型号
    os_version VARCHAR(30),                -- 系统版本
    app_version VARCHAR(20),               -- App版本
    bluetooth_mac VARCHAR(17),             -- 蓝牙MAC地址
    bind_status TINYINT DEFAULT 1,         -- 绑定状态: 0解绑 1绑定
    bind_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_sync_at TIMESTAMP,                -- 最后同步时间
    is_primary TINYINT DEFAULT 0,          -- 是否主设备
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE KEY uk_user_device (user_id, device_id),
    INDEX idx_device_id (device_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.1.3 用户配置表 (user_settings)

```sql
CREATE TABLE user_settings (
    id VARCHAR(36) PRIMARY KEY,
    user_id VARCHAR(36) NOT NULL UNIQUE,
    
    -- 通知设置
    notification_enabled TINYINT DEFAULT 1,
    pulse_reminder_enabled TINYINT DEFAULT 1,
    pulse_reminder_time VARCHAR(20) DEFAULT '08:00', -- 提醒时间
    
    -- 脉诊设置
    default_measurement_duration TINYINT DEFAULT 60, -- 默认采集时长(秒)
    auto_sync_enabled TINYINT DEFAULT 1,             -- 自动同步
    high_quality_only TINYINT DEFAULT 1,             -- 只保存高质量数据
    
    -- 隐私设置
    data_sharing_enabled TINYINT DEFAULT 0,          -- 数据共享(用于研究)
    cloud_backup_enabled TINYINT DEFAULT 1,          -- 云端备份
    
    -- 显示设置
    theme VARCHAR(20) DEFAULT 'light',               -- 主题
    language VARCHAR(10) DEFAULT 'zh-CN',            -- 语言
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 2.2 脉诊数据表

#### 2.2.1 脉诊记录表 (pulse_records)

```sql
CREATE TABLE pulse_records (
    id VARCHAR(36) PRIMARY KEY,
    user_id VARCHAR(36) NOT NULL,
    device_id VARCHAR(50) NOT NULL,
    
    -- 基本信息
    record_time TIMESTAMP NOT NULL,        -- 记录时间
    measurement_duration SMALLINT,         -- 采集时长(秒)
    sample_rate TINYINT DEFAULT 100,       -- 采样率(Hz)
    
    -- 信号质量
    signal_quality DECIMAL(3,2),           -- 信号质量(0-1)
    valid_segments SMALLINT,               -- 有效片段数
    total_segments SMALLINT,               -- 总片段数
    
    -- 脉象识别结果
    main_pulse VARCHAR(20),                -- 主脉
    secondary_pulse VARCHAR(20),           -- 兼脉
    pulse_rate TINYINT,                    -- 脉率(次/分)
    
    -- 脉位特征
    position_floating DECIMAL(3,2),        -- 浮脉得分
    position_normal DECIMAL(3,2),          -- 中脉得分
    position_deep DECIMAL(3,2),            -- 沉脉得分
    
    -- 脉率特征
    rate_category VARCHAR(10),             -- 脉率分类: slow/normal/fast/rapid
    rhythm_regularity DECIMAL(3,2),        -- 节律规整度
    has_intermittent TINYINT DEFAULT 0,    -- 是否有间歇
    
    -- 脉力特征
    force_score DECIMAL(3,2),              -- 脉力得分
    systolic_amplitude DECIMAL(6,3),       -- 收缩期幅度
    diastolic_amplitude DECIMAL(6,3),      -- 舒张期幅度
    
    -- 脉形特征
    width_score DECIMAL(3,2),              -- 脉宽得分
    length_score DECIMAL(3,2),             -- 脉长得分
    smoothness DECIMAL(3,2),               -- 光滑度
    tautness DECIMAL(3,2),                 -- 紧张度
    fullness DECIMAL(3,2),                 -- 充盈度
    hollowness DECIMAL(3,2),               -- 中空度
    
    -- 脉势特征
    rising_slope DECIMAL(6,3),             -- 上升斜率
    falling_slope DECIMAL(6,3),            -- 下降斜率
    dicrotic_notch_depth DECIMAL(6,3),     -- 重搏切迹深度
    wave_area DECIMAL(8,3),                -- 波形面积
    
    -- 频域特征
    dominant_freq DECIMAL(4,2),            -- 主频率(Hz)
    lf_power DECIMAL(8,3),                 -- 低频功率
    hf_power DECIMAL(8,3),                 -- 高频功率
    lf_hf_ratio DECIMAL(5,2),              -- 低高频比
    
    -- 辨证结果
    syndrome VARCHAR(50),                  -- 证型
    syndrome_confidence DECIMAL(3,2),      -- 辨证置信度
    
    -- 原始数据存储
    ppg_data_url VARCHAR(255),             -- PPG数据文件URL
    feature_vector JSON,                   -- 特征向量(JSON)
    
    -- 元数据
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    synced_at TIMESTAMP,                   -- 同步时间
    sync_status TINYINT DEFAULT 0,         -- 同步状态: 0未同步 1已同步 2同步失败
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_time (user_id, record_time),
    INDEX idx_main_pulse (main_pulse),
    INDEX idx_syndrome (syndrome)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
PARTITION BY RANGE (YEAR(record_time)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION pfuture VALUES LESS THAN MAXVALUE
);
```

#### 2.2.2 脉象统计表 (pulse_statistics)

```sql
CREATE TABLE pulse_statistics (
    id VARCHAR(36) PRIMARY KEY,
    user_id VARCHAR(36) NOT NULL,
    
    -- 统计周期
    stat_type VARCHAR(10) NOT NULL,        -- 统计类型: day/week/month/year
    stat_date DATE NOT NULL,               -- 统计日期
    
    -- 脉率统计
    avg_pulse_rate TINYINT,                -- 平均脉率
    min_pulse_rate TINYINT,                -- 最小脉率
    max_pulse_rate TINYINT,                -- 最大脉率
    pulse_rate_std DECIMAL(5,2),           -- 脉率标准差
    
    -- 脉象分布
    floating_count INT DEFAULT 0,          -- 浮脉次数
    deep_count INT DEFAULT 0,              -- 沉脉次数
    slow_count INT DEFAULT 0,              -- 迟脉次数
    rapid_count INT DEFAULT 0,             -- 数脉次数
    weak_count INT DEFAULT 0,              -- 虚脉次数
    strong_count INT DEFAULT 0,            -- 实脉次数
    string_count INT DEFAULT 0,            -- 弦脉次数
    slippery_count INT DEFAULT 0,          -- 滑脉次数
    normal_count INT DEFAULT 0,            -- 平和脉次数
    
    -- 证型分布
    syndrome_distribution JSON,            -- 证型分布(JSON)
    
    -- 健康评分
    health_score TINYINT,                  -- 健康评分(0-100)
    trend VARCHAR(10),                     -- 趋势: up/down/stable
    
    -- 建议
    health_advice TEXT,                    -- 健康建议
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE KEY uk_user_stat (user_id, stat_type, stat_date),
    INDEX idx_stat_date (stat_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 2.3 中医知识库表

#### 2.3.1 方剂表 (prescriptions)

```sql
CREATE TABLE prescriptions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    
    -- 基本信息
    name VARCHAR(100) NOT NULL,            -- 方剂名称
    pinyin VARCHAR(100),                   -- 拼音
    alias VARCHAR(200),                    -- 别名
    category VARCHAR(50),                  -- 分类
    
    -- 来源
    source_book VARCHAR(100),              -- 来源典籍
    source_dynasty VARCHAR(20),            -- 朝代
    source_author VARCHAR(50),             -- 作者
    original_text TEXT,                    -- 原文
    
    -- 组成
    composition JSON NOT NULL,             -- 组成 [{"herb":"柴胡","dosage":"6g","role":"君"}]
    total_herbs TINYINT,                   -- 药味数
    
    -- 用法
    preparation TEXT,                      -- 制备方法
    dosage TEXT,                           -- 用法用量
    duration VARCHAR(50),                  -- 疗程
    
    -- 功效主治
    efficacy TEXT NOT NULL,                -- 功效
    indications TEXT NOT NULL,             -- 主治
    symptoms TEXT,                         -- 症状要点
    tongue_pulse TEXT,                     -- 舌脉特征
    
    -- 禁忌
    contraindications TEXT,                -- 禁忌
    precautions TEXT,                      -- 注意事项
    side_effects TEXT,                     -- 不良反应
    
    -- 方解
    analysis TEXT,                         -- 方解
    modifications JSON,                    -- 加减变化
    
    -- 现代应用
    modern_applications TEXT,              -- 现代应用
    clinical_studies TEXT,                 -- 临床研究
    
    -- 元数据
    authority_score DECIMAL(3,2) DEFAULT 0.8, -- 权威性评分
    usage_frequency INT DEFAULT 0,         -- 使用频次
    is_classic TINYINT DEFAULT 0,          -- 是否经典方剂
    is_official TINYINT DEFAULT 0,         -- 是否官方收录
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_name (name),
    INDEX idx_category (category),
    INDEX idx_is_classic (is_classic)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.3.2 药材表 (herbs)

```sql
CREATE TABLE herbs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    
    -- 基本信息
    name VARCHAR(100) NOT NULL,            -- 药材名称
    pinyin VARCHAR(100),                   -- 拼音
    latin_name VARCHAR(200),               -- 拉丁名
    alias VARCHAR(300),                    -- 别名
    
    -- 分类
    category VARCHAR(50),                  -- 分类: 解表药/清热药等
    sub_category VARCHAR(50),              -- 子分类
    
    -- 性味归经
    nature VARCHAR(20),                    -- 性: 寒/热/温/凉/平
    flavor VARCHAR(50),                    -- 味: 辛/甘/酸/苦/咸/淡/涩
    meridian VARCHAR(200),                 -- 归经
    
    -- 功效主治
    efficacy TEXT,                         -- 功效
    indications TEXT,                      -- 主治
    usage TEXT,                            -- 用法用量
    
    -- 注意事项
    contraindications TEXT,                -- 禁忌
    precautions TEXT,                      -- 注意事项
    toxic TINYINT DEFAULT 0,               -- 是否有毒
    
    -- 现代研究
    chemical_components TEXT,              -- 化学成分
    pharmacology TEXT,                     -- 药理作用
    clinical_use TEXT,                     -- 临床应用
    
    -- 质量标准
    quality_standard TEXT,                 -- 质量标准
    origin VARCHAR(200),                   -- 道地产区
    processing TEXT,                       -- 炮制方法
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_name (name),
    INDEX idx_category (category),
    INDEX idx_nature (nature)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.3.3 证型表 (syndromes)

```sql
CREATE TABLE syndromes (
    id INT PRIMARY KEY AUTO_INCREMENT,
    
    -- 基本信息
    name VARCHAR(100) NOT NULL,            -- 证型名称
    pinyin VARCHAR(100),                   -- 拼音
    category VARCHAR(50),                  -- 分类: 八纲/脏腑/气血津液等
    
    -- 诊断要点
    main_symptoms TEXT,                    -- 主要症状
    secondary_symptoms TEXT,               -- 次要症状
    tongue TEXT,                           -- 舌象
    pulse TEXT,                            -- 脉象
    
    -- 病机
    pathogenesis TEXT,                     -- 病机
    location VARCHAR(100),                 -- 病位
    nature VARCHAR(50),                    -- 病性
    
    -- 治法
    treatment_principle TEXT,              -- 治法
    common_prescriptions JSON,             -- 常用方剂
    common_herbs JSON,                     -- 常用药物
    
    -- 鉴别诊断
    differentiation TEXT,                  -- 鉴别要点
    similar_syndromes JSON,                -- 相似证型
    
    -- 转归预后
    prognosis TEXT,                        -- 转归预后
    complications JSON,                    -- 常见并发症
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_name (name),
    INDEX idx_category (category)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.3.4 证型-方剂关联表 (syndrome_prescription)

```sql
CREATE TABLE syndrome_prescription (
    id INT PRIMARY KEY AUTO_INCREMENT,
    syndrome_id INT NOT NULL,
    prescription_id INT NOT NULL,
    
    -- 匹配信息
    match_type VARCHAR(20),                -- 匹配类型: main/alternative
    match_score DECIMAL(3,2),              -- 匹配分数
    priority TINYINT DEFAULT 0,            -- 优先级
    
    -- 适用条件
    applicable_conditions TEXT,            -- 适用条件
    modifications_hint TEXT,               -- 加减提示
    
    -- 临床数据
    clinical_cases INT DEFAULT 0,          -- 临床案例数
    effectiveness_rate DECIMAL(4,2),       -- 有效率
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (syndrome_id) REFERENCES syndromes(id),
    FOREIGN KEY (prescription_id) REFERENCES prescriptions(id),
    UNIQUE KEY uk_syndrome_prescription (syndrome_id, prescription_id),
    INDEX idx_match_score (match_score)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.3.5 脉象-证型关联表 (pulse_syndrome)

```sql
CREATE TABLE pulse_syndrome (
    id INT PRIMARY KEY AUTO_INCREMENT,
    
    -- 脉象组合
    main_pulse VARCHAR(20) NOT NULL,       -- 主脉
    secondary_pulse VARCHAR(20),           -- 兼脉
    
    -- 对应证型
    syndrome_id INT NOT NULL,              -- 证型ID
    syndrome_name VARCHAR(100),            -- 证型名称(冗余)
    
    -- 匹配规则
    match_rules JSON,                      -- 匹配规则
    match_score DECIMAL(3,2),              -- 匹配分数
    confidence_threshold DECIMAL(3,2),     -- 置信度阈值
    
    -- 权重调整
    main_pulse_weight DECIMAL(3,2) DEFAULT 0.6,
    secondary_pulse_weight DECIMAL(3,2) DEFAULT 0.3,
    other_features_weight DECIMAL(3,2) DEFAULT 0.1,
    
    -- 临床验证
    verified_cases INT DEFAULT 0,          -- 验证案例数
    accuracy_rate DECIMAL(4,2),            -- 准确率
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (syndrome_id) REFERENCES syndromes(id),
    UNIQUE KEY uk_pulse_syndrome (main_pulse, secondary_pulse, syndrome_id),
    INDEX idx_main_pulse (main_pulse)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 2.4 推荐记录表

#### 2.4.1 方剂推荐记录表 (prescription_recommendations)

```sql
CREATE TABLE prescription_recommendations (
    id VARCHAR(36) PRIMARY KEY,
    
    -- 关联信息
    pulse_record_id VARCHAR(36) NOT NULL,  -- 脉诊记录ID
    user_id VARCHAR(36) NOT NULL,          -- 用户ID
    
    -- 推荐结果
    syndrome VARCHAR(100),                 -- 辨证结果
    syndrome_confidence DECIMAL(3,2),      -- 辨证置信度
    
    -- 推荐方剂
    recommended_prescription_id INT,       -- 推荐方剂ID
    recommended_prescription_name VARCHAR(100),
    recommendation_score DECIMAL(3,2),     -- 推荐分数
    recommendation_rank TINYINT,           -- 推荐排名
    
    -- 备选方剂
    alternative_prescriptions JSON,        -- 备选方剂列表
    
    -- 用户反馈
    user_rating TINYINT,                   -- 用户评分(1-5)
    user_feedback TEXT,                    -- 用户反馈
    is_helpful TINYINT,                    -- 是否有帮助
    adopted TINYINT DEFAULT 0,             -- 是否采纳
    
    -- 效果跟踪
    follow_up_date DATE,                   -- 随访日期
    effect_evaluation TEXT,                -- 效果评估
    side_effects TEXT,                     -- 副作用
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (pulse_record_id) REFERENCES pulse_records(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (recommended_prescription_id) REFERENCES prescriptions(id),
    INDEX idx_user_created (user_id, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 2.5 系统日志表

#### 2.5.1 操作日志表 (operation_logs)

```sql
CREATE TABLE operation_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    
    user_id VARCHAR(36),                   -- 用户ID
    device_id VARCHAR(50),                 -- 设备ID
    
    -- 操作信息
    operation_type VARCHAR(50) NOT NULL,   -- 操作类型
    operation_desc TEXT,                   -- 操作描述
    
    -- 请求信息
    request_params JSON,                   -- 请求参数
    request_ip VARCHAR(50),                -- 请求IP
    request_ua VARCHAR(500),               -- User-Agent
    
    -- 响应信息
    response_code INT,                     -- 响应码
    response_message TEXT,                 -- 响应消息
    
    -- 性能
    execution_time_ms INT,                 -- 执行时间(ms)
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_operation (user_id, operation_type),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
PARTITION BY RANGE (UNIX_TIMESTAMP(created_at)) (
    PARTITION p2023 VALUES LESS THAN (UNIX_TIMESTAMP('2024-01-01')),
    PARTITION p2024 VALUES LESS THAN (UNIX_TIMESTAMP('2025-01-01')),
    PARTITION p2025 VALUES LESS THAN (UNIX_TIMESTAMP('2026-01-01')),
    PARTITION pfuture VALUES LESS THAN MAXVALUE
);
```

## 三、数据字典

### 3.1 枚举值定义

#### 脉象类型 (pulse_types)

| 代码 | 名称 | 分类 | 说明 |
|------|------|------|------|
| floating | 浮脉 | 浮脉类 | 轻按即得 |
| deep | 沉脉 | 沉脉类 | 重按始得 |
| slow | 迟脉 | 迟脉类 | 一息不足四至 |
| rapid | 数脉 | 数脉类 | 一息五至以上 |
| weak | 虚脉 | 虚脉类 | 举按无力 |
| strong | 实脉 | 实脉类 | 举按有力 |
| slippery | 滑脉 | 实脉类 | 往来流利 |
| string | 弦脉 | 实脉类 | 端直如弦 |
| thin | 细脉 | 虚脉类 | 脉细如线 |
| rough | 涩脉 | 迟脉类 | 艰涩不畅 |
| full | 洪脉 | 浮脉类 | 浮大有力 |
| tight | 紧脉 | 实脉类 | 绷急有力 |
| moderate | 缓脉 | 迟脉类 | 一息四至 |
| irregular | 结脉 | 迟脉类 | 迟而时止 |
| ... | ... | ... | ... |

#### 证型分类 (syndrome_categories)

| 代码 | 名称 | 说明 |
|------|------|------|
| exterior | 表证 | 外感病初期 |
| interior_heat | 里热证 | 里实热证 |
| interior_cold | 里寒证 | 里虚寒证 |
| qi_deficiency | 气虚证 | 元气不足 |
| blood_deficiency | 血虚证 | 血液亏虚 |
| yin_deficiency | 阴虚证 | 阴液不足 |
| yang_deficiency | 阳虚证 | 阳气不足 |
| qi_stagnation | 气滞证 | 气机阻滞 |
| blood_stasis | 血瘀证 | 血液瘀滞 |
| phlegm_damp | 痰湿证 | 痰湿内停 |
| liver_stagnation | 肝郁气滞 | 肝气郁结 |
| ... | ... | ... |

#### 方剂分类 (prescription_categories)

| 代码 | 名称 | 说明 |
|------|------|------|
| exterior_releasing | 解表剂 | 解除表证 |
| heat_clearing | 清热剂 | 清除热邪 |
| purgative | 泻下剂 | 通导大便 |
| harmonizing | 和解剂 | 调和脏腑 |
| warming_interior | 温里剂 | 温中散寒 |
| tonifying | 补益剂 | 补益气血阴阳 |
| blood_regulating | 理血剂 | 调理血液 |
| qi_regulating | 理气剂 | 调理气机 |
| dampness_removing | 祛湿剂 | 祛除湿邪 |
| phlegm_removing | 祛痰剂 | 祛除痰饮 |
| ... | ... | ... |

## 四、数据库优化

### 4.1 索引策略

```sql
-- 高频查询索引
CREATE INDEX idx_pulse_records_user_time ON pulse_records(user_id, record_time DESC);
CREATE INDEX idx_pulse_records_syndrome ON pulse_records(syndrome, record_time);

-- 复合索引
CREATE INDEX idx_prescriptions_category_score ON prescriptions(category, authority_score DESC);
CREATE INDEX idx_syndrome_prescription_match ON syndrome_prescription(syndrome_id, match_score DESC);

-- 全文索引
CREATE FULLTEXT INDEX idx_prescriptions_indications ON prescriptions(indications);
CREATE FULLTEXT INDEX idx_herbs_efficacy ON herbs(efficacy);
```

### 4.2 分区策略

```sql
-- 脉诊记录按年分区
ALTER TABLE pulse_records PARTITION BY RANGE (YEAR(record_time)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION pfuture VALUES LESS THAN MAXVALUE
);

-- 操作日志按月分区
ALTER TABLE operation_logs PARTITION BY RANGE (UNIX_TIMESTAMP(created_at)) (
    PARTITION p202401 VALUES LESS THAN (UNIX_TIMESTAMP('2024-02-01')),
    PARTITION p202402 VALUES LESS THAN (UNIX_TIMESTAMP('2024-03-01')),
    -- ...
    PARTITION pfuture VALUES LESS THAN MAXVALUE
);
```

### 4.3 备份策略

| 数据类型 | 备份频率 | 保留周期 | 备份方式 |
|----------|----------|----------|----------|
| 用户数据 | 每日 | 30天 | 全量备份 |
| 脉诊记录 | 实时 | 永久 | 增量备份 |
| 中医知识库 | 每周 | 永久 | 全量备份 |
| 日志数据 | 每日 | 90天 | 归档备份 |

---

*文档版本: v1.0*  
*最后更新: 2024年1月*
